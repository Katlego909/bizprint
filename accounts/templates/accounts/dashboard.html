{% extends 'products/base.html' %}
{% load static %}

{% block title %}My Dashboard - BizPrint{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px; margin: 2rem auto;">
    
    <!-- Welcome Section -->
    <div class="dashboard-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div>
            <h1 style="margin-bottom: 0.5rem;">Welcome, {{ request.user.first_name }}!</h1>
            <p style="color: #666;">Manage your orders, designs, and account details.</p>
        </div>
        <div class="quick-actions">
            <a href="{% url 'products:product_list' %}" class="btn btn-primary">New Print Order</a>
            <a href="{% url 'designs:design_request_create' %}" class="btn btn-secondary" style="margin-left: 1rem;">New Design Request</a>
        </div>
    </div>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 2rem;">
        
        <!-- Recent Orders Card -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;">Recent Print Orders</h3>
                <a href="{% url 'products:my_orders' %}" style="font-size: 0.9rem; color: #1d3557; text-decoration: underline;">View All</a>
            </div>
            
            {% if recent_orders %}
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid #eee;">
                            <th style="padding: 0.5rem;">Ref</th>
                            <th style="padding: 0.5rem;">Product</th>
                            <th style="padding: 0.5rem;">Status</th>
                            <th style="padding: 0.5rem;">Date</th>
                            <th style="padding: 0.5rem;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in recent_orders %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 0.8rem 0.5rem;">#{{ order.uuid|stringformat:"s"|slice:":8" }}</td>
                            <td style="padding: 0.8rem 0.5rem;">{{ order.product.name }}</td>
                            <td style="padding: 0.8rem 0.5rem;">
                                <span class="badge badge-{{ order.status }}">{{ order.get_status_display }}</span>
                            </td>
                            <td style="padding: 0.8rem 0.5rem;">{{ order.created_at|date:"M d" }}</td>
                            <td style="padding: 0.8rem 0.5rem; text-align: right;">
                                <a href="{% url 'products:track_order_result' %}?ref={{ order.uuid }}" class="btn-sm">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #777; font-style: italic;">No recent orders found.</p>
                <a href="{% url 'products:product_list' %}" class="btn btn-outline" style="margin-top: 1rem; display: inline-block;">Start Shopping</a>
            {% endif %}
        </div>

        <!-- Recent Designs Card -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h3 style="margin: 0;">Recent Design Requests</h3>
                <a href="{% url 'designs:my_design_requests' %}" style="font-size: 0.9rem; color: #1d3557; text-decoration: underline;">View All</a>
            </div>

            {% if recent_designs %}
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid #eee;">
                            <th style="padding: 0.5rem;">ID</th>
                            <th style="padding: 0.5rem;">Status</th>
                            <th style="padding: 0.5rem;">Date</th>
                            <th style="padding: 0.5rem;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in recent_designs %}
                        <tr style="border-bottom: 1px solid #eee;">
                            <td style="padding: 0.8rem 0.5rem;">#{{ req.id }}</td>
                            <td style="padding: 0.8rem 0.5rem;">
                                <span class="badge badge-{{ req.status }}">{{ req.get_status_display }}</span>
                            </td>
                            <td style="padding: 0.8rem 0.5rem;">{{ req.created_at|date:"M d" }}</td>
                            <td style="padding: 0.8rem 0.5rem; text-align: right;">
                                <a href="{% url 'designs:design_request_quote' req.quote_token %}" class="btn-sm">View</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p style="color: #777; font-style: italic;">No design requests found.</p>
                <a href="{% url 'designs:design_request_create' %}" class="btn btn-outline" style="margin-top: 1rem; display: inline-block;">Request Design</a>
            {% endif %}
        </div>

    </div>

    <!-- Account Details Section -->
    <div class="card" style="margin-top: 2rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0;">Account Details</h3>
            <a href="{% url 'accounts:edit_profile' %}" class="btn btn-outline">Edit Profile</a>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div>
                <strong>Name:</strong><br>
                {{ request.user.first_name }} {{ request.user.last_name }}
            </div>
            <div>
                <strong>Email:</strong><br>
                {{ request.user.email }}
            </div>
            <div>
                <strong>Phone:</strong><br>
                {{ request.user.profile.phone|default:"Not set" }}
            </div>
            <div>
                <strong>Address:</strong><br>
                {{ request.user.profile.address|default:"Not set" }}
            </div>
        </div>
    </div>

</div>

<style>
    .btn-sm {
        padding: 0.3rem 0.8rem;
        font-size: 0.85rem;
        background: #eee;
        color: #333;
        border-radius: 4px;
        text-decoration: none;
    }
    .btn-sm:hover {
        background: #ddd;
    }
    
    /* Badge Styles */
    .badge {
        padding: 0.25rem 0.6rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: bold;
        text-transform: uppercase;
    }
    
    /* Status Colors */
    .badge-received, .badge-pending { background: #e2e8f0; color: #4a5568; }
    .badge-in_production, .badge-in_progress { background: #bee3f8; color: #2b6cb0; }
    .badge-shipped, .badge-ready { background: #feebc8; color: #c05621; }
    .badge-completed, .badge-paid { background: #c6f6d5; color: #2f855a; }
    .badge-cancelled { background: #fed7d7; color: #c53030; }

    @media (max-width: 768px) {
        .dashboard-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        .quick-actions {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 0.5rem;
        }
        .quick-actions a {
            width: 100%;
            margin-left: 0 !important;
            text-align: center;
        }
        .dashboard-grid {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}
